
<!doctype html public "âœ°">
<!--[if lt IE 7]> <html lang="en-us" class="no-js ie6"> <![endif]-->
<!--[if IE 7]>    <html lang="en-us" class="no-js ie7"> <![endif]-->
<!--[if IE 8]>    <html lang="en-us" class="no-js ie8"> <![endif]-->
<!--[if IE 9]>    <html lang="en-us" class="no-js ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en-us" class="no-js"> <!--<![endif]-->
	<head>
	    <meta charset="utf-8" />

        <title>Cube Draft - MTGBot (The ultimate Magic the Gathering Twitch.tv bot)</title>

	<!-- iPhone, iPad and Android specific settings -->

		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        
		<link href="/Images/interface/iOS_icon.png" rel="apple-touch-icon">
        
        
        <link href="/Content/reset.css" rel="stylesheet"/>

		<!--<link rel="stylesheet" href="styles/adminica/reset.css">-->
		<link rel="stylesheet prefetch" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:400,700">


		<!-- NOTE: The following css files have been combined and minified into plugins.css

		<link rel="stylesheet" href="styles/plugins/colorpicker/colorpicker.css">
		<link rel="stylesheet" href="styles/plugins/datatables/datatables.css">
		<link rel="stylesheet" href="styles/plugins/elfinder/elfinder.css">
		<link rel="stylesheet" href="styles/plugins/fancybox/fancybox.css">
		<link rel="stylesheet" href="styles/plugins/fullcalendar/fullcalendar.css">
		<link rel="stylesheet" href="styles/plugins/isotope/isotope.css">
		<link rel="stylesheet" href="styles/plugins/multiselect/multiselect.css">
		<link rel="stylesheet" href="styles/plugins/select2/select2.css">
		<link rel="stylesheet" href="styles/plugins/selectbox/selectbox.css">
		<link rel="stylesheet" href="styles/plugins/slidernav/slidernav.css">
		<link rel="stylesheet" href="styles/plugins/slidernav/smallipop.css">
		<link rel="stylesheet" href="styles/plugins/syntaxhighlighter/syntaxhighlighter.css">
		<link rel="stylesheet" href="styles/plugins/syntaxhighlighter/shThemeDefault.css">
		<link rel="stylesheet" href="styles/plugins/tagit/tagit.css">
		<link rel="stylesheet" href="styles/plugins/themeroller/themeroller.css">
		<link rel="stylesheet" href="styles/plugins/tinyeditor/tinyeditor.css">
		<link rel="stylesheet" href="styles/plugins/tiptip/tiptip.css">
		<link rel="stylesheet" href="styles/plugins/uistars/uistars.css">
		<link rel="stylesheet" href="styles/plugins/uitotop/uitotop.css">
		<link rel="stylesheet" href="styles/plugins/uniform/uniform.css"> -->
		<!--<link rel="stylesheet" href="styles/plugins/all/plugins.css">-->
		<link href="/Content/plugins/colorpicker/colorpicker.css" rel="stylesheet"/>
<link href="/Content/plugins/datatables/datatables.css" rel="stylesheet"/>
<link href="/Content/plugins/elfinder/elfinder.css" rel="stylesheet"/>
<link href="/Content/plugins/fancybox/fancybox.css" rel="stylesheet"/>
<link href="/Content/plugins/isotope/isotope.css" rel="stylesheet"/>
<link href="/Content/plugins/multiselect/multiselect.css" rel="stylesheet"/>
<link href="/Content/plugins/select2/select2.css" rel="stylesheet"/>
<link href="/Content/plugins/selectbox/selectbox.css" rel="stylesheet"/>
<link href="/Content/plugins/slidernav/slidernav.css" rel="stylesheet"/>
<link href="/Content/plugins/syntaxhighlighter/syntaxhighlighter.css" rel="stylesheet"/>
<link href="/Content/plugins/syntaxhighlighter/shThemeDefault.css" rel="stylesheet"/>
<link href="/Content/plugins/tagit/tagit.css" rel="stylesheet"/>
<link href="/Content/plugins/themeroller/themeroller.css" rel="stylesheet"/>
<link href="/Content/plugins/tinyeditor/tinyeditor.css" rel="stylesheet"/>
<link href="/Content/plugins/tiptip/tiptip.css" rel="stylesheet"/>
<link href="/Content/plugins/uistars/uistars.css" rel="stylesheet"/>
<link href="/Content/plugins/uitotop/uitotop.css" rel="stylesheet"/>
<link href="/Content/plugins/uniform/uniform.css" rel="stylesheet"/>



		<!-- NOTE: The following css files have been combined and minified into all.css

		<link rel="stylesheet" href="styles/adminica/text.css">
		<link rel="stylesheet" href="styles/adminica/grid.css">
		<link rel="stylesheet" href="styles/adminica/main.css">
		<link rel="stylesheet" href="styles/adminica/mobile.css">
		<link rel="stylesheet" href="styles/adminica/base.css">
		<link rel="stylesheet" href="styles/adminica/ie.css">
		<link rel="stylesheet" href="styles/themes/switcher.css"> -->
		<!--<link rel="stylesheet" href="styles/adminica/all.css">-->
		<link href="/Content/all.css" rel="stylesheet"/>




		<!-- Style Switcher

		The following stylesheet links are used by the styleswitcher to allow for dynamically changing the Adminica layout, nav, skin, theme and background.
		Styleswitcher documentation: http://style-switcher.webfactoryltd.com/documentation/

		layout_switcher.php	: layout - fluid by default.								(eg. styles/themes/layout_switcher.php?default=layout_fixed.css)
		nav_switcher.php	: header and sidebar nav  positioning - sidebar by default.	(eg. styles/themes/nav_switcher.php?default=header_top.css)
		skin_switcher.php 	: Adminica skin - dark by default.							(eg. styles/themes/skin_switcher.php?default=theme_light.css)
		theme_switcher.php 	: colour theme - black/grey by default.						(eg. styles/themes/theme_switcher.php?default=theme_red.css)
		bg_switcher.php 	: background image - dark boxes by default.					(eg. styles/themes/bg_switcher.php?default=bg_honeycomb.css)	-->

		
        <!--
		<link rel="stylesheet" href="styles/themes/layout_switcher.php?default=layout_fixed.css" >
		<link rel="stylesheet" href="styles/themes/nav_switcher.php?default=nav_top.css" >
		<link rel="stylesheet" href="styles/themes/skin_switcher.php?default=switcher.css" >
		<link rel="stylesheet" href="styles/themes/theme_switcher.php?default=theme_blue.css" >
		<link rel="stylesheet" href="styles/themes/bg_switcher.php?default=bg_honeycomb.css" >

		<link rel="stylesheet" href="styles/adminica/colours.css"> <!-- this file overrides the theme's default colour scheme, allowing more colour combinations (see layout example page)
        -->
        
        <link href="/Content/colours.css" rel="stylesheet"/>

		<link href="/Content/themes/nav_top.css" rel="stylesheet"/>

		<link href="/Content/themes/bg_noise.css" rel="stylesheet"/>


	<!-- NOTE: The following js files have been conbined and minified into plugins-min.js

		<script src="scripts/jquery/jquery.js"></script>
		<script src="scripts/jquery/jqueryui.js"></script>
		<script src="scripts/modernizr/modernizr.js"></script>
		<script src="scripts/prefixfree/prefixfree.js"></script>
		<script src="scripts/pjax/pjax.js"></script>
		<script src="scripts/isotope/isotope.js"></script>
		<script src="scripts/autogrow/autogrow.js"></script>
		<script src="scripts/colorpicker/colorpicker.js"></script>
		<script src="scripts/cookie/cookie.js"></script>
		<script src="scripts/datatables/datatables.js"></script>
		<script src="scripts/elfinder/elfinder.js"></script>
		<script src="scripts/dragscroll/dragScroll.js"></script>
		<script src="scripts/tinyeditor/tinyeditor.js"></script>
		<script src="scripts/fancybox/fancybox.js"></script>
		<script src="scripts/flot/flot_excanvas.js"></script>
		<script src="scripts/flot/flot.js"></script>
		<script src="scripts/flot/flot_resize.js"></script>
		<script src="scripts/flot/flot_pie.js"></script>
		<script src="scripts/flot/flot_pie_update.js"></script>
		<script src="scripts/fullcalendar/fullcalendar.js"></script>
		<script src="scripts/fullcalendar/fullcalendar_gcal.js"></script>
		<script src="scripts/hoverintent/hoverIntent.js"></script>
		<script src="scripts/iscroll/iscroll.js"></script>
		<script src="scripts/knob/knob.js"></script>
		<script src="scripts/multiselect/multiselect.js"></script>
		<script src="scripts/select2/select2.js"></script>
		<script src="scripts/selectbox/selectbox.js"></script>
		<script src="scripts/slidernav/slidernav.js"></script>
		<script src="scripts/smallipop/smallipop.js"></script>
		<script src="scripts/sparkline/sparkline.js"></script>
		<script src="scripts/syntaxhighlighter/shCore.js"></script>
		<script src="scripts/syntaxhighlighter/shBrushJScript.js"></script>
		<script src="scripts/syntaxhighlighter/shBrushXml.js"></script>
		<script src="scripts/tagit/tagit.js"></script>
		<script src="scripts/timepicker/timepicker.js"></script>
		<script src="scripts/tinyeditor/tinyeditor.js"></script>
		<script src="scripts/tiptip/tiptip.js"></script>
		<script src="scripts/touchpunch/touchpunch.js"></script>
		<script src="scripts/uistars/uistars.js"></script>
		<script src="scripts/uitotop/uitotop.js"></script>
		<script src="scripts/uniform/uniform.js"></script>
		<script src="scripts/validation/validation.js"></script> -->
        <script src="/Scripts/jquery/jquery.js"></script>
<script src="/Scripts/jquery/jquery-migrate.js"></script>
<script src="/Scripts/jquery/jqueryui.js"></script>
<script src="/Scripts/modernizr/modernizr.js"></script>
<script src="/Scripts/prefixfree/prefixfree.js"></script>
<script src="/Scripts/isotope/isotope.js"></script>
<script src="/Scripts/autogrow/autogrow.js"></script>
<script src="/Scripts/colorpicker/colorpicker.js"></script>
<script src="/Scripts/cookie/cookie.js"></script>
<script src="/Scripts/datatables/datatables.js"></script>
<script src="/Scripts/elfinder/elfinder.js"></script>
<script src="/Scripts/tinyeditor/tinyeditor.js"></script>
<script src="/Scripts/fancybox/fancybox.js"></script>
<script src="/Scripts/flot/flot_excanvas.js"></script>
<script src="/Scripts/flot/flot.js"></script>
<script src="/Scripts/flot/flot_resize.js"></script>
<script src="/Scripts/flot/flot_pie.js"></script>
<script src="/Scripts/flot/flot_pie_update.js"></script>
<script src="/Scripts/hoverintent/hoverIntent.js"></script>
<script src="/Scripts/knob/knob.js"></script>
<script src="/Scripts/multiselect/multiselect.js"></script>
<script src="/Scripts/select2/select2.js"></script>
<script src="/Scripts/slidernav/slidernav.js"></script>
<script src="/Scripts/smallipop/smallipop.js"></script>
<script src="/Scripts/sparkline/sparkline.js"></script>
<script src="/Scripts/syntaxhighlighter/shCore.js"></script>
<script src="/Scripts/syntaxhighlighter/shBrushJScript.js"></script>
<script src="/Scripts/syntaxhighlighter/shBrushXml.js"></script>
<script src="/Scripts/tagit/tagit.js"></script>
<script src="/Scripts/timepicker/timepicker.js"></script>
<script src="/Scripts/tiptip/tiptip.js"></script>
<script src="/Scripts/touchpunch/touchpunch.js"></script>
<script src="/Scripts/uistars/uistars.js"></script>
<script src="/Scripts/uitotop/uitotop.js"></script>
<script src="/Scripts/uniform/uniform.js"></script>
<script src="/Scripts/validation/validation.js"></script>
<script src="/Scripts/tmpl/tmpl.js"></script>
<script src="/Scripts/sound/sound.js"></script>
<script src="/Scripts/mtgbot/global.js"></script>

        

		<!--
		<script src="scripts/plugins-min.js"></script>
        -->

		<!-- NOTE: The following js files have been conbined and minified into adminica_all-min.js

		    <script src="scripts/adminica/adminica_ui.js"></script>
		    <script src="scripts/adminica/adminica_mobile.js"></script>
		    <script src="scripts/adminica/adminica_datatables.js"></script>
		    <script src="scripts/adminica/adminica_calendar.js"></script>
		    <script src="scripts/adminica/adminica_charts.js"></script>
		    <script src="scripts/adminica/adminica_gallery.js"></script>
		    <script src="scripts/adminica/adminica_various.js"></script>
		    <script src="scripts/adminica/adminica_wizard.js"></script>
		    <script src="scripts/adminica/adminica_forms.js"></script>
		    <script src="scripts/adminica/adminica_load.js"></script>	-->
		<!--
		    <script src="scripts/adminica/adminica_all-min.js"></script>
            
            -->
		<script src="/Scripts/adminica/adminica_calendar.js"></script>
<script src="/Scripts/adminica/adminica_charts.js"></script>
<script src="/Scripts/adminica/adminica_datatables.js"></script>
<script src="/Scripts/adminica/adminica_forms.js"></script>
<script src="/Scripts/adminica/adminica_gallery.js"></script>
<script src="/Scripts/adminica/adminica_load.js"></script>
<script src="/Scripts/adminica/adminica_mobile.js"></script>
<script src="/Scripts/adminica/adminica_ui.js"></script>
<script src="/Scripts/adminica/adminica_various.js"></script>
<script src="/Scripts/adminica/adminica_wizard.js"></script>

	</head>
<body>
    <div id="wrapper" data-adminica-nav-top="1" data-adminica-side-top="1">
        <div id="topbar" class="clearfix" style="display: none" > 
            <a href="#" class="logo"><span>MTGBot</span></a>
                
            <!--
                <div class="user_box dark_box clearfix">
                    <img src="images/interface/profile.jpg" width="55" alt="Profile Pic" />
                    <h2>Administrator</h2>
                    <h3><a class="text_shadow" href="#">John Smith</a></h3>
                    <ul>
                        <li><a href="#">profile</a><span class="divider">|</span></li>
                        <li><a href="#">settings</a><span class="divider">|</span></li>
                        <li><a href="login_slide.php" class="dialog_button" data-dialog="dialog_logout">Logout</a></li>
                    </ul>
                </div><!-- #user_box -->
            -->
        </div><!-- #topbar -->
        <div id="main_container" class="main_container container_16 clearfix">
            <div id="nav_top" class="dropdown_menu clearfix round_top">
                <ul class="clearfix">
                    <li class="icon_only"><a href="/"><img src="/Images/icons/small/grey/laptop.png" alt="" /><span class="display_none">Home</span></a></li>
                    <li><a href="/DraftViewer"><img src="/Images/icons/small/grey/presentation.png" alt="" /><span>Draft Viewer</span></a></li>
                    <li><a href="/Commands"><img src="/Images/icons/small/grey/robot.png" alt="" /><span>MTGBot Command Listing</span></a></li>
                    <li><a href="/Contact"><img src="/Images/icons/small/grey/phone_hook.png" alt="" /><span>Contact the Developer</span></a></li>
                    <li><a href="/Contact/Bug"><img src="/Images/icons/small/grey/cog_4.png" alt="" /><span>Report a Bug</span></a></li>
                    <li><a href="/Donate"><img src="/Images/icons/small/grey/paypal_3.png" alt="" /><span>Donate</span></a></li>
                </ul>

                <div id="mobile_nav">
                    <div class="main"></div>
                    <div class="side"></div>
                </div>
            </div>
            <!-- #nav_top -->
            

<style type="text/css">
#picks .gallery li a.reserved
{
    background-color: #1C5EA0;
    border-color: #064792;
}

#votes h3 {
    height: 30px;
    margin: 0px !important;
    padding: 0px;
}

#picks .previous_pick_overlay {
    background: #eb0c0a url(/Images/ui-bg_diagonals-thick_40_eb0c0a_40x40.png) 50% 50% repeat;
    opacity: .5;
    filter: Alpha(Opacity=50);
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
}

#picks .previous_pick_overlay.picked {
    background: #0a2feb url(/Images/ui-bg_diagonals-thick_40_0a2feb_40x40.png) 50% 50% repeat;
}

#votes .ui-progressbar-value {
    margin: -31px -1px -1px -1px;
}

#votes .ui-progressbar-value.green {
    background-color: #5eb95e;
    background-image: -moz-linear-gradient(top, #62c462, #57a957);
    background-image: -ms-linear-gradient(top, #62c462, #57a957);
    background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#62c462), to(#57a957));
    background-image: -webkit-linear-gradient(top, #62c462, #57a957);
    background-image: -o-linear-gradient(top, #62c462, #57a957);
    background-image: linear-gradient(top, #62c462, #57a957);
    background-repeat: repeat-x;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#62c462', endColorstr='#57a957', GradientType=0);
}

#votes .ui-progressbar-value.yellow {
    background-color: #faa732;
    background-image: -moz-linear-gradient(top, #fbb450, #f89406);
    background-image: -ms-linear-gradient(top, #fbb450, #f89406);
    background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#fbb450), to(#f89406));
    background-image: -webkit-linear-gradient(top, #fbb450, #f89406);
    background-image: -o-linear-gradient(top, #fbb450, #f89406);
    background-image: linear-gradient(top, #fbb450, #f89406);
    background-repeat: repeat-x;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#fbb450', endColorstr='#f89406', GradientType=0);
}

#votes .ui-progressbar-value.red {
    background-color: #dd514c;
    background-image: -moz-linear-gradient(top, #ee5f5b, #c43c35);
    background-image: -ms-linear-gradient(top, #ee5f5b, #c43c35);
    background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#ee5f5b), to(#c43c35));
    background-image: -webkit-linear-gradient(top, #ee5f5b, #c43c35);
    background-image: -o-linear-gradient(top, #ee5f5b, #c43c35);
    background-image: linear-gradient(top, #ee5f5b, #c43c35);
    background-repeat: repeat-x;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ee5f5b', endColorstr='#c43c35', GradientType=0);
}

#votes .ui-progressbar-value {
    -webkit-transition: width 0.6s ease;
    -moz-transition: width 0.6s ease;
    -ms-transition: width 0.6s ease;
    -o-transition: width 0.6s ease;
    transition: width 0.6s ease;
}

</style>

<div class="box grid_16">
    <h2 class="box_head">Current Pick: <div data-bind="text: currentpick" style="display: inline;">&nbsp;</div>, Pack: <div data-bind="text: currentpack" style="display: inline;">&nbsp;</div></h2>
    <div class="section block" data-bind="visible: !selections().length && !waiting().length" style="display: none; height: 141px;">
        <h2>Pick accepted. Waiting for adjacent player to pass your next booster.</h2>
    </div>
    <div data-bind="visible: waiting().length" class="section block" style="display: none">
        <h2>Waiting for Players:</h2>
        <ul data-bind="foreach: waiting">
            <li data-bind="text: TwitchUsername"></li>
        </ul>
    </div>
    <div class="isotope_holder indented_area" style="margin: 0;" data-bind="foreach: selections">
        <div style="float: left; padding: 3px;">
            <img draggable="true" data-bind="attr: { src: fullLink($data), alt: Name }, event: {
/*mouseover: $root.enableDetails, mouseout: $root.disableDetails,*/ click: $root.addSelection
                    , dragstart: function (data, event) {
                        console.log([data, event]);
                        event.originalEvent.dataTransfer.setData('from', 'selections');
                        event.originalEvent.dataTransfer.setData('data', data.Id); 
                        return true;
                    }
            }" style="width: 104px; cursor: pointer;" draggable="true" />
        </div>
    </div>
    <div style="clear: both;"></div>
</div>


<div class="box grid_12">
    <h2 class="box_head">
        Deck
        <button class="light small has_text send_right" data-bind="click: sortByCost">Cost</button>
        <button class="light small has_text send_right" data-bind="click: sortByColor">Color</button>
        <div class="send_right">Sort By: &nbsp;</div>
    </h2>
    <div class="block">
        <div class="section" style="min-height: 151px" data-bind="event: {
    dragover: function (data, event) { event.preventDefault(); },
    drop: function (data, event) {
        var from = event.originalEvent.dataTransfer.getData('from');
                var id = event.originalEvent.dataTransfer.getData('data');
                $root.movePick(from, id);
            }
        }">
            <table>
                <tr class="cards" data-bind="foreach: columns">
                    <td data-bind="foreach: $data, style: { height: (134 + 20 * $data.length) + 'px' }" style="width: 108px">
                        <div style="padding: 0 2px 0 2px" data-bind="attr: { style: 'z-index: ' + $index() + '; position: absolute; margin-top: ' + $index() * 20 + 'px;' }, event: { /*mouseover: $root.enableDetails, mouseout: $root.disableDetails*/ }">
                            <img data-bind="attr: { src: fullLink($data), alt: Name }, event: {
    dragstart: function(data, event) {
        event.originalEvent.dataTransfer.setData('from', 'deck');
        event.originalEvent.dataTransfer.setData('data', data.Id); 
        return true; }
                            }" draggable="true" style="width: 104px;" />
                        </div>
                        <div style="clear: both"></div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>



<div class="box grid_4">
    <h2 class="box_head">Sideboard</h2>
    <div class="block">
        <div class="section" style="min-height: 151px" data-bind="event: {
    dragover: function (data, event) { event.preventDefault(); },
    drop: function (data, event) {
        var from = event.originalEvent.dataTransfer.getData('from');
        var id = event.originalEvent.dataTransfer.getData('data');
        $root.movePick(from, id, 'sideboard');
    }
}">
			<table>
                <tr class="cards">
                    <td data-bind="foreach: sideboard, visible: sideboard().length > 0, style: { height: (134 + 20 * sideboard().length) + 'px' }">
                        <div data-bind="attr: { style: 'z-index: ' + $index() + '; position: absolute; margin-top: ' + $index()*20 + 'px;' }, event: {/* mouseover: enableDetails, mouseout: disableDetails*/ }">
                            <img data-bind="attr: { src: fullLink($data), alt: Name }, event: {
    dragstart: function (data, event) {
                                        event.originalEvent.dataTransfer.setData('from', 'sideboard');
                                        event.originalEvent.dataTransfer.setData('data', data.Id);
                                        return true;
                                    }
                                }" style="width: 104px;" />
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>


        </div>
        <div id="loading_overlay">
            <div class="loading_message round_bottom">
                <img src="/Images/interface/loading.gif" alt="loading" />
            </div>
        </div>
    </div>
    
    <!--Script references. -->
    <script src="/Scripts/knockout/knockout.js"></script>

    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="/Scripts/jquery.signalR-1.0.1.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.--> 
    <script type="text/javascript">
        $(function() {
            // Reference the auto-generated proxy for the hub.  
            var mtg = $.connection.cubeHub;
            $.connection.hub.logging = true;

            function draftViewModel() {
                var self = this;
                var draftId = 2;
                self.timed = ko.observable(false);
                self.loaded = ko.observable(false);
                self.players = ko.observableArray([{"Id":17,"TwitchUsername":"danbopes","MtgoUsername":"danbopes","Position":1},{"Id":18,"TwitchUsername":"bud_white","MtgoUsername":"solebush1","Position":2}]);


                self.waiting = ko.observableArray([]);

                self.selection = ko.observable(false);
                self.selections = ko.observableArray([]);

                self.deck = ko.observableArray([]);
                self.sideboard = ko.observableArray([]);

                /*
                self.currentpick = ko.computed(function() {
                    return Math.min(self.deck().length + self.sideboard().length + 1, 45);
                });*/
                self.currentpick = ko.observable(0);

                self.currentpack = ko.computed(function() {
                    return Math.ceil(self.currentpick() / 15);
                });

                self.sortBy = ko.observable("color");
                self.draftOver = ko.observable(false);

                self.myclock = ko.observable(0);

                self.addingLand = ko.observable(false);
                self.swamp = ko.observable(0);
                self.mountain = ko.observable(0);
                self.plains = ko.observable(0);
                self.island = ko.observable(0);
                self.forest = ko.observable(0);

                self.dragsel = "init";

                var timer, origz, origw;

                this.sortByColor = function() {
                    self.sortBy("color");
                };

                this.sortByCost = function() {
                    self.sortBy("cost");
                };

                this.addSelection = function(data) {
                    if (!self.timed())
                        self.movePick('selections', data.Id);
                    else {
                        //A bit more logic needs to go here;
                        self.selectPick('selections', data.Id);
                    }
                };

                this.movePick = function(from, pickId, where) {
                    console.log([from, pickId, where]);
                    var obj = null;
                    switch (from) {
                        case 'selections':
                            obj = ko.utils.arrayFilter(self.selections(), function(card) {
                                return card.Id == pickId;
                            });

                            if (obj.length == 0)
                                return;

                            obj = obj[0];
                            obj.pickId = pickId;
                            self.selections.removeAll();

                            console.log('Taking pick:');
                            mtg.server.takePick(draftId, self.currentpick(), pickId);
                            break;
                        case 'deck':
                            obj = ko.utils.arrayFilter(self.deck(), function(card) {
                                return card.Id == pickId;
                            });

                            if (obj.length == 0)
                                return;

                            obj = obj[0];
                            
                            self.deck.remove(obj);
                        break;
                        case 'sideboard':
                            obj = ko.utils.arrayFilter(self.sideboard(), function(card) {
                                return card.Id == pickId;
                            });

                            if (obj.length == 0)
                                return;
                            
                            obj = obj[0];

                            self.sideboard.remove(obj);
                        break;
                    }

                    if (obj == null)
                        return;

                    if (where == 'sideboard') {
                        self.sideboard.push(obj);
                    } else {
                        self.deck.push(obj);
                    }
                };

                this.columns = ko.computed(function() {
                    var desiredType = self.sortBy();
                    var cards = self.deck();
                    var rowCards = [];
                    var result = [];

                    if (desiredType == "cost") {
                        for (var i = 0; i <= 20; i++) {
                            rowCards = ko.utils.arrayFilter(cards, function(card) {
                                return card.CMC == i;
                            });

                            if (rowCards.length > 0)
                                result.push(rowCards);
                        }
                    } else if (desiredType == "color") {
                        //Match all the colors
                        var colors = ['L', 'C', 'W', 'U', 'B', 'R', 'G'];

                        $.each(colors, function(idx, color) {
                            rowCards = ko.utils.arrayFilter(cards, function(card) {
                                return card.Color == color;
                            });

                            if (rowCards.length > 0)
                                result.push(rowCards);
                        });

                        //Match multicolored
                        rowCards = ko.utils.arrayFilter(cards, function(card) {
                            return $.inArray(card.Color, colors) == -1;
                        });

                        if (rowCards.length > 0)
                            result.push(rowCards);
                    }

                    //console.log(result);
                    return result;
                });

                toggleLand = function() {
                    var current = self.addingLand();
                    self.addingLand(!current);
                };

                this.submitDeck = function() {
                    window.location = "/Home/Play";
                };

                /*this.deck = ko.computed(function () {
                    var sdbIds = new Array();

                    ko.utils.arrayForEach(this.sideboard(), function (item) {
                        sdbIds.push(item.draftId)
                    });

                    return ko.utils.arrayFilter(this.selections(), function (card) {
                        return jQuery.inArray(card.draftId, sdbIds) == -1;
                    });
                }, this);*/

                this.tick = function() {
                    var timeremaining = self.myclock() - 1;
                    if (timeremaining > 0) {
                        self.myclock(timeremaining);
                    } else {
                        //var defaultpick = self.contacts()[0];
                        //self.addSelection(defaultpick);
                        //self.myclock("");
                    }
                };


                this.enableDetails = function(item, event) {
                    origz = $(event.target).css('z-index');
                    origw = $(event.target).css('width');
                    $(event.target).css('position', 'absolute');

                    $(event.target).css('z-index', '1000');
                    $(event.target).css('width', 'auto');
                };

                this.disableDetails = function(item, event) {
                    $(event.target).css('width', origw);
                    $(event.target).css('z-index', origz);
                    $(event.target).css('position', 'static');
                };

                self.addSideboard = function(card) {
                    self.deck.remove(card);
                    self.sideboard.push(card);
                };

                self.removeSideboard = function(card) {
                    self.sideboard.remove(card);
                    self.deck.push(card);
                };

                self.textDeck = function() {
                    //alert(self.sideboardids());
                    /*var mysideboard = JSON.stringify(self.sideboard());
                    $("body").append("<iframe src='" + "/api/Contacts?sideboard=" + mysideboard + "' style='display: none;' ></iframe>");*/

                };


                //Let's attach to some events
                mtg.client.waitingForPlayers = function(playerIds) {
                    self.waiting(ko.utils.arrayFilter(self.players(), function(player) {
                        return $.inArray(player.Id, playerIds) > -1;
                    }));

                };

                mtg.client.pendingSelection = function(pickId, cards, time) {
                    self.currentpick(pickId);
                    self.selections(cards);
                    self.waiting.removeAll();

                    if (timer > -1) {
                        //TODO in the future
                        if (time != undefined) {
                            clearTimeout(self.timer);
                        }

                        self.myclock(time);
                        setInterval(self.tick, 1000);
                    }
                };

                mtg.client.draftSelection = function(card, pickId) {
                    //TODO
                    console.log(card, pickId);
                };


                /*
                
                self.submitLandFromForm = function(formElement) {
                    // If valid, post the serialized form data to the web api
                    var jsonform = $(formElement).serializeObject();
                    var selection = JSON.stringify(jsonform);
                    toggleLand();

                    $.ajax({
                        url: "/api/Draft",
                        type: "PUT",
                        data: selection,
                        datatype: "json",
                        contentType: "application/json; charset=utf-8",
                    })
                        .done(function(postreturn) {
                            self.selections(postreturn.Picks);
                            //self.selections.push(data);
                        });

                };

               self.getDraft = function () {
                   $.getJSON("/api/Draft")
                       .done(function (data) {
                           if (data.CurrentPack.packCards != null) {
                               self.contacts(data.CurrentPack.packCards);
                               self.myclock(40);
                               timer = setInterval(self.tick, 1000);
                               self.loaded(true);
                               clearInterval(refresher);
                           }

                       });
                   if (self.selections().length > 44) {
                       clearInterval(timer);
                       self.draftOver(true);
                   }
               }*/

                /*this.land = ko.computed(function () {
                    return ko.utils.arrayFilter(this.deck(), function (card) {
                        return String(card.Colours) == "L";
                    });
                }, this);*/


                /*suggestLand = function () {
                    self.sortBy("colour");
                    var cards = self.deck().length - self.land().length;
                    var lands = Math.round(0.74 * cards);
                    var total = lands + cards;
                    var swampcount = Math.round((self.selections3c().length / cards) * lands) + Math.round((self.selections3c().length / cards) * self.selections7c().length);
                    var plainscount = Math.round((self.selections6c().length / cards) * lands) + Math.round((self.selections6c().length / cards) * self.selections7c().length);
                    var islandcount = Math.round((self.selections2c().length / cards) * lands) + Math.round((self.selections2c().length / cards) * self.selections7c().length);
                    var mountaincount = Math.round((self.selections4c().length / cards) * lands) + Math.round((self.selections4c().length / cards) * self.selections7c().length);
                    var forestcount = Math.round((self.selections5c().length / cards) * lands) + Math.round((self.selections5c().length / cards) * self.selections7c().length);
                    self.swamp(swampcount);
                    self.plains(plainscount);
                    self.island(islandcount);
                    self.mountain(mountaincount);
                    self.forest(forestcount);
                }*/

                // Load the initial state
                // <img data-bind="attr: { src: Self + '.png'}" /> click: $parent.addSelection(media.m)
                /*$.getJSON("/api/Draft",
                  function (data) {
                      self.contacts(data.CurrentPack.packCards);
                      self.selections(data.Picks);
                  })
                    .done(function () {
                        self.loaded(true);
                        self.myclock(40);
                        timer = setInterval(self.tick, 1000);
                        if (self.selections().length > 44) {
                            clearInterval(timer);
                            self.draftOver(true);
                        }
                    });*/
            }

            ;

            $.fn.serializeObject = function() {
                var o = {};
                var a = this.serializeArray();
                $.each(a, function() {
                    if (o[this.name]) {
                        if (!o[this.name].push) {
                            o[this.name] = [o[this.name]];
                        }
                        o[this.name].push(this.value || '');
                    } else {
                        o[this.name] = this.value || '';
                    }
                });
                return o;
            };

            ko.applyBindings(new draftViewModel());

            mtg.client.addVote = function(pickId, card, username) {
                console.log("Add Vote");
                console.log({ pickId: pickId, card: card, username: username });
                console.log(votes);

                if (votes[pickId]) {
                    if (!votes[pickId][card.Id]) {
                        votes[pickId][card.Id] = {
                            li: null,
                            votes: 0
                        };
                    }
                } else {
                    votes[pickId] = {
                        totalVotes: 0
                    };
                    votes[pickId][card.Id] = {
                        li: null,
                        votes: 0
                    };
                }

                votes[pickId].totalVotes++;
                votes[pickId][card.Id].votes++;

                if (votes.currentVote == null || votes.currentVote != pickId) {
                    return;
                }

                if (votes[pickId][card.Id].li != null) {
                    /*$(votes[vote.Id].li).find('div.content table tbody').append(
                        $('<tr />').append(
                            $('<td />').text(username)
                        )
                    );*/
                    votes[pickId][card.Id].li.find('span.vote').text(votes[pickId][card.Id].votes);
                    //$('#votes').accordion('refresh');
                } else {
                    var li = $('<li />').append(
                        $('<h3 class="bar" style="text-shadow: none" />').append(
                            $('<span />').css('padding-left', 10).text(card.Name)
                        ).append(
                            $('<span class="vote" />').css({ 'padding-right': 10, 'float': 'right' }).text(votes[pickId][card.Id].votes)
                        )
                    )/*.append(
                        $('<div class="content" />').append(
                            $('<table class="static" />').append(
                                $('<tbody />').append(
                                    $('<tr />').append(
                                        $('<td />').text(username)
                                    )
                                )
                            )
                        )
                    )*/;

                    $('#votes').isotope({
                        getSortData: {
                            votes: function($elem) {
                                return parseInt($elem.data('votes'));
                            }
                        },
                        sortBy: 'votes',
                        sortAscending: false
                    }).isotope('insert', li);
                    //$('#votes').accordion('refresh');
                    votes[pickId][card.Id].li = li;

                    $(li).find('h3').progressbar({
                        create: function() {
                            $(this).find('div.ui-progressbar-value').removeClass('red yellow green');

                            var value = this.getAttribute("aria-valuenow");
                            if (value < 30) {
                                $(this).find('div.ui-progressbar-value').addClass('red');
                            } else if (value < 60) {
                                $(this).find('div.ui-progressbar-value').addClass('yellow');
                            } else {
                                $(this).find('div.ui-progressbar-value').addClass('green');
                            }
                        },
                        change: function() {
                            $(this).find('div.ui-progressbar-value').removeClass('red yellow green');

                            var value = this.getAttribute("aria-valuenow");
                            if (value < 30) {
                                $(this).find('div.ui-progressbar-value').addClass('red');
                            } else if (value < 60) {
                                $(this).find('div.ui-progressbar-value').addClass('yellow');
                            } else {
                                $(this).find('div.ui-progressbar-value').addClass('green');
                            }
                        },
                        value: Math.floor(votes[pickId][card.Id].votes / votes[pickId].totalVotes * 100)
                    });
                }

                $.each(votes[pickId], function(idx, vote) {
                    if (!vote.li) return;
                    $(vote.li).find('h3').progressbar('value', Math.floor(vote.votes / votes[pickId].totalVotes * 100));
                    $(vote.li).data('votes', vote.votes);
                });

                $('#votes').isotope('reloadItems').isotope({ sortBy: 'votes' }).isotope('reLayout');
                /*
                var ul = $('#votes');
                var li = ul.children('li');

                li.sort(function(a, b) {
                    return ( $(a).data('votes') < $(b).data('votes') ) ? 1 :
                    ( $(a).data('votes') > $(b).data('votes') ) ? -1 : 0;
                });
                ul.append(li);
                */

                //<li><h3 class="bar">Blowfly Infestation</h3><div class="content" style="display: none" /></li>
                //<li><h3 class="bar">Boon Reflection</h3><div class="content" style="display: none" /></li>
            };

            // Set initial focus to message input box.  
            $('#tabs-pack1, #tabs-pack2, #tabs-pack3').find('ul').accordion('option', 'active', false);

            // Start the connection.
            $.connection.hub.start().done(function() {
                console.log(mtg.server);
                mtg.server.subscribeToDrafting(2);

                /*$('#sendmessage').click(function () {
                        // Call the Send method on the hub. 
                        chat.server.send($('#message').val());
                        // Clear text box and reset focus for next comment. 
                        $('#message').val('').focus();
                    });*/
            });
            // This optional function html-encodes messages for display in the page.
        });

        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>

    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-40486857-1']);
        _gaq.push(['_trackPageview']);

        (function () {

            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>
</body>
</html>
        <!--
            <!DOCTYPE html>
            <html lang="en">
                <head>
                    <meta charset="utf-8" />
                    <title>Cube Draft - MTGBot (The ultimate Magic the Gathering Twitch.tv bot)</title>
                    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon" />
                    <meta name="viewport" content="width=device-width" />
                    <link href="/Content/css" rel="stylesheet"/>

                    <script src="/bundles/modernizr"></script>

                </head>
                <body>
                    <header>
                        <div class="content-wrapper">
                            <div class="float-left">
                                <p class="site-title"><a href="/">MTG Bot</a></p>
                            </div>
                            <div class="float-right">
                                <section id="login">
                                        <ul>
        <li><a href="/Account/Register" id="registerLink">Register</a></li>
        <li><a href="/Account/Login" id="loginLink">Log in</a></li>
    </ul>

                                </section>
                                <nav>
                                    <ul id="menu">
                                        <li><a href="/">Home</a></li>
                                        <li><a href="/Home/About">About</a></li>
                                        <li><a href="/Home/Contact">Contact</a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </header>
                    <div id="body">
                        
                        <section class="content-wrapper main-content clear-fix">
                            //RenderBody()
                        </section>
                    </div>
                    <footer>
                        <div class="content-wrapper">
                            <div class="float-left">
                                <p>&copy; 2013 - My ASP.NET MVC Application</p>
                            </div>
                        </div>
                    </footer>

                    <script src="/bundles/jquery"></script>

                    RenderSection("scripts", required: false)
                </body>
            </html>
            
-->